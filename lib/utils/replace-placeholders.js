"use strict";
// Â© 2024 Amazon Web Services, Inc. or its affiliates.
// All Rights Reserved. This AWS Content is provided subject to the terms of
// the AWS Customer Agreement available at <http://aws.amazon.com/agreement>
// or other written agreement between Customer and either
// Amazon Web Services, Inc. or Amazon Web Service EMEA SARL or both.
// Copyright 2024 Amazon.com and its affiliates; all rights reserved.
// This file is Amazon Web Services Content and may not be duplicated
// or distributed without permission.
Object.defineProperty(exports, "__esModule", { value: true });
exports.getServiceName = exports.copyFilesAndFolders = exports.deleteFolder = exports.renameFile = exports.replaceInFile = void 0;
const fs = require("node:fs");
const path = require("node:path");
const process = require("process");
const replaceInFile = (filePath, replacements) => {
    let content = fs.readFileSync(filePath, 'utf-8');
    replacements.forEach(([regex, replacement]) => {
        content = content.replace(regex, replacement);
    });
    fs.writeFileSync(filePath, content);
};
exports.replaceInFile = replaceInFile;
const renameFile = (filePath, newFilePath) => {
    fs.renameSync(filePath, newFilePath);
};
exports.renameFile = renameFile;
const deleteFolder = (folderPath) => {
    if (fs.existsSync(folderPath)) {
        fs.rmSync(folderPath, { recursive: true, force: true });
    }
};
exports.deleteFolder = deleteFolder;
const copyFilesAndFolders = (sourcePath, destinationPath, projectName) => {
    const LOWER_PROJECT_NAME = projectName.charAt(0).toLowerCase() + projectName.slice(1);
    const UPPER_PROJECT_NAME = projectName.charAt(0).toUpperCase() + projectName.slice(1);
    // Create the destination directory if it doesn't exist
    if (!fs.existsSync(destinationPath)) {
        fs.mkdirSync(destinationPath, { recursive: true });
    }
    // Read all files and directories in the source path
    const FILES = fs.readdirSync(sourcePath);
    for (const FILE of FILES) {
        const SRC_PATH = path.join(sourcePath, FILE);
        const STATS = fs.statSync(SRC_PATH);
        if (STATS.isDirectory()) {
            let newFolderPath;
            if (FILE.includes('${app}')) {
                const NEW_FOLDER_NAME = FILE.replace('${app}', LOWER_PROJECT_NAME);
                newFolderPath = path.join(destinationPath, NEW_FOLDER_NAME);
                (0, exports.deleteFolder)(newFolderPath); // Delete the existing folder
                fs.mkdirSync(newFolderPath, { recursive: true });
                (0, exports.copyFilesAndFolders)(SRC_PATH, newFolderPath, projectName);
            }
            else {
                const FOLDER_PATH = path.join(destinationPath, FILE);
                (0, exports.deleteFolder)(FOLDER_PATH); // Delete the existing folder
                fs.mkdirSync(FOLDER_PATH, { recursive: true });
                (0, exports.copyFilesAndFolders)(SRC_PATH, FOLDER_PATH, projectName);
            }
        }
        else if (STATS.isFile()) {
            let newFilePath;
            if (FILE.includes('${app}')) {
                newFilePath = path.join(destinationPath, FILE.replace('${app}', LOWER_PROJECT_NAME));
            }
            else {
                newFilePath = path.join(destinationPath, FILE);
            }
            const TEMP_FILE_PATH = path.join(destinationPath, `temp_${FILE}`);
            fs.copyFileSync(SRC_PATH, TEMP_FILE_PATH);
            (0, exports.replaceInFile)(TEMP_FILE_PATH, [
                [/\${name}/g, LOWER_PROJECT_NAME],
                [/\${Name}/g, UPPER_PROJECT_NAME],
            ]);
            if (fs.existsSync(newFilePath)) {
                fs.unlinkSync(newFilePath); // Delete the existing file
            }
            fs.copyFileSync(TEMP_FILE_PATH, newFilePath);
            (0, exports.renameFile)(TEMP_FILE_PATH, newFilePath);
        }
    }
};
exports.copyFilesAndFolders = copyFilesAndFolders;
const getServiceName = (folderPath) => {
    if (folderPath) {
        return folderPath.split(path.sep).slice(-1)[0];
    }
    else {
        return process.cwd().split(path.sep).slice(-1)[0];
    }
};
exports.getServiceName = getServiceName;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmVwbGFjZS1wbGFjZWhvbGRlcnMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvdXRpbHMvcmVwbGFjZS1wbGFjZWhvbGRlcnMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLHNEQUFzRDtBQUN0RCw0RUFBNEU7QUFDNUUsNEVBQTRFO0FBQzVFLHlEQUF5RDtBQUN6RCxxRUFBcUU7QUFDckUscUVBQXFFO0FBQ3JFLHFFQUFxRTtBQUNyRSxxQ0FBcUM7OztBQUVyQyw4QkFBOEI7QUFDOUIsa0NBQWtDO0FBQ2xDLG1DQUFtQztBQUU1QixNQUFNLGFBQWEsR0FBRyxDQUMzQixRQUFnQixFQUNoQixZQUFxQyxFQUNyQyxFQUFFO0lBQ0YsSUFBSSxPQUFPLEdBQUcsRUFBRSxDQUFDLFlBQVksQ0FBQyxRQUFRLEVBQUUsT0FBTyxDQUFDLENBQUM7SUFDakQsWUFBWSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsS0FBSyxFQUFFLFdBQVcsQ0FBQyxFQUFFLEVBQUU7UUFDNUMsT0FBTyxHQUFHLE9BQU8sQ0FBQyxPQUFPLENBQUMsS0FBSyxFQUFFLFdBQVcsQ0FBQyxDQUFDO0lBQ2hELENBQUMsQ0FBQyxDQUFDO0lBQ0gsRUFBRSxDQUFDLGFBQWEsQ0FBQyxRQUFRLEVBQUUsT0FBTyxDQUFDLENBQUM7QUFDdEMsQ0FBQyxDQUFDO0FBVFcsUUFBQSxhQUFhLGlCQVN4QjtBQUVLLE1BQU0sVUFBVSxHQUFHLENBQUMsUUFBZ0IsRUFBRSxXQUFtQixFQUFFLEVBQUU7SUFDbEUsRUFBRSxDQUFDLFVBQVUsQ0FBQyxRQUFRLEVBQUUsV0FBVyxDQUFDLENBQUM7QUFDdkMsQ0FBQyxDQUFDO0FBRlcsUUFBQSxVQUFVLGNBRXJCO0FBRUssTUFBTSxZQUFZLEdBQUcsQ0FBQyxVQUFrQixFQUFFLEVBQUU7SUFDakQsSUFBSSxFQUFFLENBQUMsVUFBVSxDQUFDLFVBQVUsQ0FBQyxFQUFFLENBQUM7UUFDOUIsRUFBRSxDQUFDLE1BQU0sQ0FBQyxV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IEFtYXpvbiBXZWIgU2VydmljZXMsIEluYy4gb3IgaXRzIGFmZmlsaWF0ZXMuXG4vLyBBbGwgUmlnaHRzIFJlc2VydmVkLiBUaGlzIEFXUyBDb250ZW50IGlzIHByb3ZpZGVkIHN1YmplY3QgdG8gdGhlIHRlcm1zIG9mXG4vLyB0aGUgQVdTIEN1c3RvbWVyIEFncmVlbWVudCBhdmFpbGFibGUgYXQgPGh0dHA6Ly9hd3MuYW1hem9uLmNvbS9hZ3JlZW1lbnQ+XG4vLyBvciBvdGhlciB3cml0dGVuIGFncmVlbWVudCBiZXR3ZWVuIEN1c3RvbWVyIGFuZCBlaXRoZXJcbi8vIEFtYXpvbiBXZWIgU2VydmljZXMsIEluYy4gb3IgQW1hem9uIFdlYiBTZXJ2aWNlIEVNRUEgU0FSTCBvciBib3RoLlxuLy8gQ29weXJpZ2h0IDIwMjQgQW1hem9uLmNvbSBhbmQgaXRzIGFmZmlsaWF0ZXM7IGFsbCByaWdodHMgcmVzZXJ2ZWQuXG4vLyBUaGlzIGZpbGUgaXMgQW1hem9uIFdlYiBTZXJ2aWNlcyBDb250ZW50IGFuZCBtYXkgbm90IGJlIGR1cGxpY2F0ZWRcbi8vIG9yIGRpc3RyaWJ1dGVkIHdpdGhvdXQgcGVybWlzc2lvbi5cblxuaW1wb3J0ICogYXMgZnMgZnJvbSAnbm9kZTpmcyc7XG5pbXBvcnQgKiBhcyBwYXRoIGZyb20gJ25vZGU6cGF0aCc7XG5pbXBvcnQgKiBhcyBwcm9jZXNzIGZyb20gJ3Byb2Nlc3MnO1xuXG5leHBvcnQgY29uc3QgcmVwbGFjZUluRmlsZSA9IChcbiAgZmlsZVBhdGg6IHN0cmluZyxcbiAgcmVwbGFjZW1lbnRzOiBBcnJheTxbUmVnRXhwLCBzdHJpbmddPixcbikgPT4ge1xuICBsZXQgY29udGVudCA9IGZzLnJlYWRGaWxlU3luYyhmaWxlUGF0aCwgJ3V0Zi04Jyk7XG4gIHJlcGxhY2VtZW50cy5mb3JFYWNoKChbcmVnZXgsIHJlcGxhY2VtZW50XSkgPT4ge1xuICAgIGNvbnRlbnQgPSBjb250ZW50LnJlcGxhY2UocmVnZXgsIHJlcGxhY2VtZW50KTtcbiAgfSk7XG4gIGZzLndyaXRlRmlsZVN5bmMoZmlsZVBhdGgsIGNvbnRlbnQpO1xufTtcblxuZXhwb3J0IGNvbnN0IHJlbmFtZUZpbGUgPSAoZmlsZVBhdGg6IHN0cmluZywgbmV3RmlsZVBhdGg6IHN0cmluZykgPT4ge1xuICBmcy5yZW5hbWVTeW5jKGZpbGVQYXRoLCBuZXdGaWxlUGF0aCk7XG59O1xuXG5leHBvcnQgY29uc3QgZGVsZXRlRm9sZGVyID0gKGZvbGRlclBhdGg6IHN0cmluZykgPT4ge1xuICBpZiAoZnMuZXhpc3RzU3luYyhmb2xkZXJQYXRoKSkge1xuICAgIGZzLnJtU3luYyhmb2xkZXJQYXRoLCB7IHJlY3Vyc2l2ZTogdHJ1ZSwgZm9yY2U6IHRydWUgfSk7XG4gIH1cbn07XG5cbmV4cG9ydCBjb25zdCBjb3B5RmlsZXNBbmRGb2xkZXJzID0gKFxuICBzb3VyY2VQYXRoOiBzdHJpbmcsXG4gIGRlc3RpbmF0aW9uUGF0aDogc3RyaW5nLFxuICBwcm9qZWN0TmFtZTogc3RyaW5nLFxuKSA9PiB7XG4gIGNvbnN0IExPV0VSX1BST0pFQ1RfTkFNRSA9XG4gICAgcHJvamVjdE5hbWUuY2hhckF0KDApLnRvTG93ZXJDYXNlKCkgKyBwcm9qZWN0TmFtZS5zbGljZSgxKTtcbiAgY29uc3QgVVBQRVJfUFJPSkVDVF9OQU1FID1cbiAgICBwcm9qZWN0TmFtZS5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIHByb2plY3ROYW1lLnNsaWNlKDEpO1xuXG4gIC8vIENyZWF0ZSB0aGUgZGVzdGluYXRpb24gZGlyZWN0b3J5IGlmIGl0IGRvZXNuJ3QgZXhpc3RcbiAgaWYgKCFmcy5leGlzdHNTeW5jKGRlc3RpbmF0aW9uUGF0aCkpIHtcbiAgICBmcy5ta2RpclN5bmMoZGVzdGluYXRpb25QYXRoLCB7IHJlY3Vyc2l2ZTogdHJ1ZSB9KTtcbiAgfVxuXG4gIC8vIFJlYWQgYWxsIGZpbGVzIGFuZCBkaXJlY3RvcmllcyBpbiB0aGUgc291cmNlIHBhdGhcbiAgY29uc3QgRklMRVMgPSBmcy5yZWFkZGlyU3luYyhzb3VyY2VQYXRoKTtcblxuICBmb3IgKGNvbnN0IEZJTEUgb2YgRklMRVMpIHtcbiAgICBjb25zdCBTUkNfUEFUSCA9IHBhdGguam9pbihzb3VyY2VQYXRoLCBGSUxFKTtcbiAgICBjb25zdCBTVEFUUyA9IGZzLnN0YXRTeW5jKFNSQ19QQVRIKTtcblxuICAgIGlmIChTVEFUUy5pc0RpcmVjdG9yeSgpKSB7XG4gICAgICBsZXQgbmV3Rm9sZGVyUGF0aDogc3RyaW5nO1xuICAgICAgaWYgKEZJTEUuaW5jbHVkZXMoJyR7YXBwfScpKSB7XG4gICAgICAgIGNvbnN0IE5FV19GT0xERVJfTkFNRSA9IEZJTEUucmVwbGFjZSgnJHthcHB9JywgTE9XRVJfUFJPSkVDVF9OQU1FKTtcbiAgICAgICAgbmV3Rm9sZGVyUGF0aCA9IHBhdGguam9pbihkZXN0aW5hdGlvblBhdGgsIE5FV19GT0xERVJfTkFNRSk7XG4gICAgICAgIGRlbGV0ZUZvbGRlcihuZXdGb2xkZXJQYXRoKTsgLy8gRGVsZXRlIHRoZSBleGlzdGluZyBmb2xkZXJcbiAgICAgICAgZnMubWtkaXJTeW5jKG5ld0ZvbGRlclBhdGgsIHsgcmVjdXJzaXZlOiB0cnVlIH0pO1xuICAgICAgICBjb3B5RmlsZXNBbmRGb2xkZXJzKFNSQ19QQVRILCBuZXdGb2xkZXJQYXRoLCBwcm9qZWN0TmFtZSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25zdCBGT0xERVJfUEFUSCA9IHBhdGguam9pbihkZXN0aW5hdGlvblBhdGgsIEZJTEUpO1xuICAgICAgICBkZWxldGVGb2xkZXIoRk9MREVSX1BBVEgpOyAvLyBEZWxldGUgdGhlIGV4aXN0aW5nIGZvbGRlclxuICAgICAgICBmcy5ta2RpclN5bmMoRk9MREVSX1BBVEgsIHsgcmVjdXJzaXZlOiB0cnVlIH0pO1xuICAgICAgICBjb3B5RmlsZXNBbmRGb2xkZXJzKFNSQ19QQVRILCBGT0xERVJfUEFUSCwgcHJvamVjdE5hbWUpO1xuICAgICAgfVxuICAgIH0gZWxzZSBpZiAoU1RBVFMuaXNGaWxlKCkpIHtcbiAgICAgIGxldCBuZXdGaWxlUGF0aDogc3RyaW5nO1xuICAgICAgaWYgKEZJTEUuaW5jbHVkZXMoJyR7YXBwfScpKSB7XG4gICAgICAgIG5ld0ZpbGVQYXRoID0gcGF0aC5qb2luKFxuICAgICAgICAgIGRlc3RpbmF0aW9uUGF0aCxcbiAgICAgICAgICBGSUxFLnJlcGxhY2UoJyR7YXBwfScsIExPV0VSX1BST0pFQ1RfTkFNRSksXG4gICAgICAgICk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBuZXdGaWxlUGF0aCA9IHBhdGguam9pbihkZXN0aW5hdGlvblBhdGgsIEZJTEUpO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBURU1QX0ZJTEVfUEFUSCA9IHBhdGguam9pbihkZXN0aW5hdGlvblBhdGgsIGB0ZW1wXyR7RklMRX1gKTtcbiAgICAgIGZzLmNvcHlGaWxlU3luYyhTUkNfUEFUSCwgVEVNUF9GSUxFX1BBVEgpO1xuXG4gICAgICByZXBsYWNlSW5GaWxlKFRFTVBfRklMRV9QQVRILCBbXG4gICAgICAgIFsvXFwke25hbWV9L2csIExPV0VSX1BST0pFQ1RfTkFNRV0sXG4gICAgICAgIFsvXFwke05hbWV9L2csIFVQUEVSX1BST0pFQ1RfTkFNRV0sXG4gICAgICBdKTtcblxuICAgICAgaWYgKGZzLmV4aXN0c1N5bmMobmV3RmlsZVBhdGgpKSB7XG4gICAgICAgIGZzLnVubGlua1N5bmMobmV3RmlsZVBhdGgpOyAvLyBEZWxldGUgdGhlIGV4aXN0aW5nIGZpbGVcbiAgICAgIH1cblxuICAgICAgZnMuY29weUZpbGVTeW5jKFRFTVBfRklMRV9QQVRILCBuZXdGaWxlUGF0aCk7XG4gICAgICByZW5hbWVGaWxlKFRFTVBfRklMRV9QQVRILCBuZXdGaWxlUGF0aCk7XG4gICAgfVxuICB9XG59O1xuXG5leHBvcnQgY29uc3QgZ2V0U2VydmljZU5hbWUgPSAoZm9sZGVyUGF0aDogc3RyaW5nKSA9PiB7XG4gIGlmIChmb2xkZXJQYXRoKSB7XG4gICAgcmV0dXJuIGZvbGRlclBhdGguc3BsaXQocGF0aC5zZXApLnNsaWNlKC0xKVswXTtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gcHJvY2Vzcy5jd2QoKS5zcGxpdChwYXRoLnNlcCkuc2xpY2UoLTEpWzBdO1xuICB9XG59O1xuIl19